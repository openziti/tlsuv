if (MSVC)
    find_package(unofficial-getopt-win32 REQUIRED)
endif()

add_library(common OBJECT common.c)
target_link_libraries(common PUBLIC tlsuv)
target_compile_definitions(common PUBLIC $<$<BOOL:${TLSUV_HTTP}>:TLSUV_HTTP>)

message(NOTICE "TLSUV_HTTP = ${TLSUV_HTTP}")

set(samples
        sample
        engine_test
        sample-cf
)
if (TLSUV_HTTP)
    list(APPEND samples
            um-curl
            repeat-fetch
            ws-client
            http-ping
    )
endif()

foreach (s ${samples})
    add_executable(${s} ${s}.c)
    target_link_libraries(${s} PUBLIC tlsuv common)
    if (MSVC)
        target_link_libraries(um-curl PRIVATE unofficial::getopt-win32::getopt)
    endif()
endforeach()
